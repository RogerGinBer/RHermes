---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# RHermes

<!-- badges: start -->
[![Codecov test coverage](https://codecov.io/gh/RogerGinBer/RHermes/branch/master/graph/badge.svg?token=HL73R4GHFJ)](https://codecov.io/gh/RogerGinBer/RHermes?branch=master)

<!-- badges: end -->

The goal of RHermes is to analyse LC-MS and LC-MS/MS data to identify compounds
in biological or environmental samples. The RHermes workflow works with
both Orbitrap and q-TOF instrument data.


## System requirements

The recommended system requirements are:

* At least a 4 core processor
* 16 GB of RAM or more
* An internet connection to perform KEGG queries

## Installation

You can install the released version of RHermes from
[Bioconductor](https://bioconductor.org/) with:

```{r, eval = FALSE}
if(!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
BiocManager::install("RHermes")
```

Alternatively, you can download the development version from
[GitHub](https://github.com/) with:

```{r, eval = FALSE}
if(!requireNamespace("devtools", quietly = TRUE))
    install.packages("devtools")
devtools::install_github("RogerGinBer/RHermes")
```
## Setup
RHermes can perform almost all its functions after installation, but the SOI
Blank Substraction step requires a valid Keras and Tensorflow installation
(which rely on Python).

### Option 1: Default installation
In principle both Keras and Tensorflow can be configured with:

```{r, eval = FALSE}
reticulate::install_miniconda()
keras::install_keras()
tensorflow::install_tensorflow()
```
After which you can check the following:
```{r, eval = FALSE}
tensorflow::tf_config()
model <- keras::load_model_tf(system.file("extdata", "model", package = "RHermes"))
```
If both commands don't give any error (the "Your CPU supports ..." warning is
fine) the installation has been successful. 
If it fails (which can happen in some devices, try Option 2).

### Option 2: Manual installation
First install Miniconda:
```{r, eval = FALSE}
reticulate::install_miniconda()
```
Now find the Miniconda Prompt in your computer. Instead of relying on the
default r-reticulate environment, type the following to create a new
environment:

conda create -n newenv python=3.6 tensorflow keras

When finished, type in R:
```{r, eval = FALSE}
reticulate::use_condaenv("newenv", required = TRUE)
tensorflow::tf_config()
model <- keras::load_model_tf(system.file("extdata", "model", package = "RHermes"))
```

Everything should run smoothly. If not, try manually installing Anaconda from
their website and letting reticulate know where to find the environment.

Also check out Keras and Tensorflow R tutorials.

## Analyzing LC-MS data with RHermes

```{r example, eval = FALSE}
library(RHermes)
#Generate a Exp object
example <- RHermesExp()

#Set your formula and adduct database
example <- setDB(example, db = "hmdb")

#Process your MS1 files
example <- processMS1(example,
                        system.file("extdata", "MS1TestData.mzML",
                        package = "RHermes"))
#Generate SOIs
example <- findSOI(example, getSOIpar(), 1)

#Generate an IL 
example <- generateIL(example, 1, ILParam())
```

Also check the User Guide for more detailed info.
