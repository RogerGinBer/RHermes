---
title: "RHermes User Guide"
author: "Roger GinÃ© Bertomeu"
date: "14/01/2021"
output:
  html_document:
      toc: true
      toc_float: true
  pdf_document: default
vignette: |
  %\VignetteIndexEntry{RHermes User Guide} %\VignetteEngine{knitr::rmarkdown}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE)
knitr::opts_chunk$set(collapse = TRUE)
```

## Intro
RHermes is an untargeted metabolomics data processing package. Its objective is to
identify a customizable set (usually >10K) of metabolites in a biological or
environmental sample.

This document will guide you through the package functions and show you what a typical
RHermes workflow looks like.

## Basic setup
To install RHermes you need an functional R and RStudio installation. 
Since RHermes is quite heavy on your CPU and memory it is recommended to have:

 - At least a 4 core processor
 - 16 GB of RAM or more
 - An internet connection to perform KEGG queries

You can install the released version of RHermes from [Bioconductor](https://bioconductor.org/) with:

``` r
# install.packages("BiocManager")
BiocManager::install("RHermes")
```

And the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("RogerGinBer/RHermes")
```

## MS1 workflow
### Setting up the RHermesExp object
All the information generated by the package is stored in a single RHermesExp object.
To generate it,  to use the S4 constructor:
```{r, message=FALSE}
library(RHermes)
myHermes <- RHermesExp()
```
This object will be the input of most of the package functions, which return an
updated version of the object.

After creating the object, set your MS1 experimental parameters. To do so, use
the function setExpParam(), which accepts either a custom ExpParam object or a
template name:
```{r}
myHermes <- setExpParam(myHermes, params = ExpParam(ppm = 4, res = 120000, ion = "+"))
myHermes <- setExpParam(myHermes, template = "orbi-pos")
```
The following template names are available: "orbi-pos", "orbi-neg", "qtof-pos" and
"qtof-neg". Check ?ExpParam() to see all customizable fields. All non-specified
ExpParam fields are left as defaults.

After setting up the ExpParam, decide which set of formulas and adducts to
detect in our data with setDB(): 
```{r}
myHermes <- setDB(myHermes, db = "hmdb") #Loads a small HMDB subset
```
A general set of adducts will be automatically set according to the experimental
parameters. You can choose multicharged and multimer adducts by using the
*adcharge* and *admult* parameters in setDB().

In general, the less combinations, the faster the 
running time will be. The function used to set the formulas and adducts 
It is also advisable to remove unlikely adducts from the adduct list.
To do so, you can check which adducts are selected by just calling
the RHermesExp object and remove adducts with remAd():
```{r}
myHermes <- remAd(myHermes, c("M+DMSO+H", "M+IsoProp+H")) #For instance, remove adducts of unused solvents
```

Here's what the object looks like up to this point:
```{r}
myHermes #Shows a summary of all set parameters and object info
```

### Processing the MS1 files into PL
The main interface to process files is the function processMS1(), which accepts an
RHermesExp object and a list of paths to the MS1 files to process. All the files 
must share the used experimental parameters (eg. data acquired in different
polarities or in different instruments can't be processed at the same time).


### SOI detection

### SOI filtering/clean-up

### Generating an Inclusion List

## MS2 workflow

## Plotting

## Using the RHermes Shiny app
To start the app, simply type:
```{r, eval=FALSE}
RHermesGUI()
```
And the app should start in your default browser.


